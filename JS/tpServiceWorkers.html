<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="../style.css">
    <title>Service Workers</title>
  </head>
  <body>
    <nav>
      <ul>
        <li><a href="../index.html">Accueil</a></li>
      </ul>
    </nav>

    <h1>TP Service Workers</h1>



  </body>

  <script type="text/javascript">

    window.addEventListener('load', () => {
          		//registerSW();

              let cors_url = "https://cors-anywhere.herokuapp.com/";
              let url = "https://planning.univ-rennes1.fr/jsp/custom/modules/plannings/9EYlGR3a.shu"


              fetch( cors_url + url ).then(function(response){
                  return response.text();
              }).then(function(text){

                console.log(text);
                let data = ICAL.parse(text);
                console.log("Objet : ");
                console.log(data)
                /*
                let result = []
                let events = jCalData[1][2];
                events.forEach(e => result.push(flattenEvent(e)));
                console.log(events);
                */
                /*
                var vcalendar = new ICAL.Component(jCalData);
                if(Array.isArray(vcalendar)) {
                  console.log("         It's an array! ");
                }else{
                  console.log(vcalendar);
                  console.log(ICAL.stringify(vcalendar));
                }
                var componentArray = vcalendar.getAllSubcomponents();
                componentArray.foreach((item,index,array)=>{console.log(">>>" + index);});
                */


                //var vevent = vcalendar.getFirstSubcomponent('vevent');
                //var summary = vevent.getFirstPropertyValue('summary');
                //console.log('Summary: ' + summary);
              });
        	});
/*
          function flattenEvent(e) {
            let event = {};
            for(let i=0;i<e[1].length;i++) {
              let prop = e[1][i];
              event[prop[0]] = prop[3];
              //console.log('e',prop);
            }
            return event;
          }

        	// Register the Service Worker
        	async function registerSW() {
          		if ('serviceWorker' in navigator) {
            		try {
              			await navigator
                    			.serviceWorker
                    			.register('serviceworker.js');
            		}
            		catch (e) {
              			console.log('SW registration failed');
            		}
          		}
        	}
*/

  </script>
</html>
