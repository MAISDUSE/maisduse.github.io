<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="../style.css">
    <title>TP3 JS Avancé 2</title>
  </head>
  <body>
    <nav>
      <ul>
        <li><a href="../index.html">Acceuil</a></li>
      </ul>
    </nav>

    <h1>TP JS Avancé</h1>

    <canvas id="canvas" width="1000" height="1000" ></canvas>



    <br>
    <img id="myImage" src="./src/car.webp" alt="Car" width="835px" height="356px" style="transform: scaleX(-1); display:none;">

  </body>

  <script>

    let canvas = document.querySelector('canvas');
    let context = canvas.getContext('2d');
    let img = document.getElementById("myImage");
    let lastFrame;
    let pixels =0;



    window.onload = function (){
    // The page is completely loaded now
    // You can reference the image element
    //context.scale(-1,1);
    context.drawImage(img, img.x, img.y, img.width / 2, img.height / 2)
    //moveToRight();
    lastFrame = new Date();

    requestAnimationFrame(animate);
}


/*
function moveToRight(pauseTime = 0)
    {
        let timer;
        let pixels =0;
        let lastFrame = new Date();

        timer = setInterval(() => {

            context.clearRect(0,0,1000,1000);

            context.drawImage(img, img.x +Math.min(progress/10, 200), img.y, img.width / 2, img.height / 2);
            pixels +=16;
            if (pixels>=canvas.width - (img.width/2) ) clearInterval(timer);

            lastFrame = new Date();

            pausecomp(pauseTime);
        }, 16);
    }



        function pausecomp(millis)
    		{
    			var date = new Date();
    			var curDate = null;
    			do {
    				curDate = new Date();
    			} while(curDate-date < millis);
    		}

*/
/*
    var start = null;


    function step(timestamp) {
      var progress;
      if (start === null) start = timestamp;
      progress = timestamp - start;
      context.clearRect(0,0,1000,1000);
      context.drawImage(img, img.x +Math.min(progress/10, (canvas.width - (img.width/2)) ), img.y, img.width / 2, img.height / 2);

      if (progress < 10000) {
        requestAnimationFrame(step);
      }
    }
*/




        function render(deltaTime, pixels)
       {
         context.clearRect(0,0,1000,1000);
         context.drawImage(img, img.x + pixels, img.y, img.width / 2, img.height / 2);


       }
        function animate()
              {

                  let cancel = false;

                  let deltaTime = new Date() - lastFrame;

                  pixels += deltaTime;

                  if ( deltaTime < 160 ) {
                      running = render(deltaTime, pixels);
                  }

                  if (pixels + deltaTime >= canvas.width - (img.width/2)) cancel = true;

                  if (cancel) return cancelAnimationFrame(game);

                  game = requestAnimationFrame(animate);

                  lastFrame = new Date();

              }







  </script>



</html>
